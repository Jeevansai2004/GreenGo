# Firestore Database Setup Guide

This guide will help you set up Firestore database for the GreenGo app.

## Step 1: Enable Firestore in Firebase Console

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project (greengo-db761)
3. Click on **Firestore Database** in the left sidebar
4. Click **Create database**
5. Choose **Start in test mode** (for development)
6. Select a location for your database (choose closest to your users)
7. Click **Enable**

## Step 2: Set Up Firestore Security Rules

1. In Firestore Database, go to **Rules** tab
2. Update the rules to allow authenticated users to read/write their own data:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can read/write their own user profile
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Users can read/write their own cart
    match /carts/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Users can create orders and read their own orders
    match /orders/{orderId} {
      allow create: if request.auth != null;
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || 
         resource.data.userEmail == request.auth.token.email);
    }
  }
}
```

3. Click **Publish**

## Step 3: Firestore Collections Structure

The app uses the following Firestore collections:

### 1. `users` Collection
- **Document ID**: User's Firebase UID
- **Fields**:
  - `name`: string
  - `email`: string
  - `emailVerified`: boolean
  - `createdAt`: timestamp
  - `updatedAt`: timestamp

### 2. `carts` Collection
- **Document ID**: User's Firebase UID
- **Fields**:
  - `items`: array of cart items
    - `id`: number (product ID)
    - `name`: string
    - `price`: number
    - `image`: string
    - `category`: string
    - `quantity`: number
  - `updatedAt`: timestamp

### 3. `orders` Collection
- **Document ID**: Auto-generated by Firestore
- **Fields**:
  - `orderId`: string (e.g., "ORD-1234567890")
  - `userId`: string (Firebase UID)
  - `userEmail`: string
  - `name`: string
  - `phone`: string
  - `address`: string
  - `items`: array of order items
  - `total`: number
  - `delivery`: string
  - `date`: string (ISO format)
  - `createdAt`: timestamp
  - `updatedAt`: timestamp

## Step 4: Test the Integration

1. Start the app: `npm start`
2. Register/Login a user
3. Add items to cart
4. Place an order
5. Check Firestore Console to see the data:
   - Go to Firestore Database > Data
   - You should see `users`, `carts`, and `orders` collections

## Features

✅ **Cart Sync**: Cart is automatically synced to Firestore for logged-in users
✅ **Order History**: All orders are saved to Firestore
✅ **User Profiles**: User data is stored in Firestore
✅ **Guest Support**: Guest users still use localStorage (cart migrates on login)
✅ **Real-time Updates**: Cart updates in real-time using Firestore listeners

## Important Notes

- **Security Rules**: Make sure to set up proper security rules before going to production
- **Data Migration**: Existing localStorage data will be migrated to Firestore when users log in
- **Guest Users**: Guest users (not logged in) will still use localStorage for cart
- **Offline Support**: Firestore has built-in offline support and will sync when online

## Troubleshooting

- **Permission Denied**: Check Firestore security rules
- **Data Not Appearing**: Check browser console for errors
- **Cart Not Syncing**: Make sure user is logged in (Firebase Auth)

